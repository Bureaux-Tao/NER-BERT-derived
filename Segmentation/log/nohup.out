Using TensorFlow backend.
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint8 = np.dtype([("qint8", np.int8, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint8 = np.dtype([("quint8", np.uint8, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint16 = np.dtype([("qint16", np.int16, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_quint16 = np.dtype([("quint16", np.uint16, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  _np_qint32 = np.dtype([("qint32", np.int32, 1)])
/home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.
  np_resource = np.dtype([("resource", np.ubyte, 1)])
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:4185: The name tf.truncated_normal is deprecated. Please use tf.random.truncated_normal instead.
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:74: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:174: The name tf.get_default_session is deprecated. Please use tf.compat.v1.get_default_session instead.
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:181: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.
2021-12-27 16:26:01.447351: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2021-12-27 16:26:01.457021: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1
2021-12-27 16:26:01.957265: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5590c055ccd0 executing computations on platform CUDA. Devices:
2021-12-27 16:26:01.957318: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): Graphics Device, Compute Capability 7.0
2021-12-27 16:26:01.961014: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2400000000 Hz
2021-12-27 16:26:01.964372: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x5590c069dac0 executing computations on platform Host. Devices:
2021-12-27 16:26:01.964414: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>
2021-12-27 16:26:01.965630: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties:
name: Graphics Device major: 7 minor: 0 memoryClockRate(GHz): 1.597
pciBusID: 0000:3b:00.0
2021-12-27 16:26:01.965999: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2021-12-27 16:26:01.967969: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
2021-12-27 16:26:01.969808: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcufft.so.10.0
2021-12-27 16:26:01.970190: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcurand.so.10.0
2021-12-27 16:26:01.972605: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusolver.so.10.0
2021-12-27 16:26:01.974432: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcusparse.so.10.0
2021-12-27 16:26:01.981324: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7
2021-12-27 16:26:01.983952: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1763] Adding visible gpu devices: 0
2021-12-27 16:26:01.984009: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudart.so.10.0
2021-12-27 16:26:01.985596: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:
2021-12-27 16:26:01.985622: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0
2021-12-27 16:26:01.985639: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N
2021-12-27 16:26:01.988378: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1326] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 30458 MB memory) -> physical GPU (device: 0, name: Graphics Device, pci bus id: 0000:3b:00.0, compute capability: 7.0)
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to
==================================================================================================
Input-Token (InputLayer)        (None, None)         0
__________________________________________________________________________________________________
Input-Segment (InputLayer)      (None, None)         0
__________________________________________________________________________________________________
Embedding-Token (Embedding)     (None, None, 312)    6591936     Input-Token[0][0]
__________________________________________________________________________________________________
Embedding-Segment (Embedding)   (None, None, 312)    624         Input-Segment[0][0]
__________________________________________________________________________________________________
Embedding-Token-Segment (Add)   (None, None, 312)    0           Embedding-Token[0][0]
                                                                 Embedding-Segment[0][0]
__________________________________________________________________________________________________
Embedding-Position (PositionEmb (None, None, 312)    159744      Embedding-Token-Segment[0][0]
__________________________________________________________________________________________________
Embedding-Norm (LayerNormalizat (None, None, 312)    624         Embedding-Position[0][0]
__________________________________________________________________________________________________
Transformer-MultiHeadSelfAttent (None, None, 312)    390624      Embedding-Norm[0][0]
                                                                 Embedding-Norm[0][0]
                                                                 Embedding-Norm[0][0]
                                                                 Transformer-FeedForward-Norm[0][0
                                                                 Transformer-FeedForward-Norm[0][0
                                                                 Transformer-FeedForward-Norm[0][0
                                                                 Transformer-FeedForward-Norm[1][0
                                                                 Transformer-FeedForward-Norm[1][0
                                                                 Transformer-FeedForward-Norm[1][0
                                                                 Transformer-FeedForward-Norm[2][0
                                                                 Transformer-FeedForward-Norm[2][0
                                                                 Transformer-FeedForward-Norm[2][0
__________________________________________________________________________________________________
Transformer-MultiHeadSelfAttent (None, None, 312)    0           Embedding-Norm[0][0]
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward-Norm[0][0
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward-Norm[1][0
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward-Norm[2][0
                                                                 Transformer-MultiHeadSelfAttentio
__________________________________________________________________________________________________
Transformer-MultiHeadSelfAttent (None, None, 312)    624         Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
__________________________________________________________________________________________________
Transformer-FeedForward (FeedFo (None, None, 312)    780312      Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-MultiHeadSelfAttentio
__________________________________________________________________________________________________
Transformer-FeedForward-Add (Ad (None, None, 312)    0           Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward[0][0]
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward[1][0]
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward[2][0]
                                                                 Transformer-MultiHeadSelfAttentio
                                                                 Transformer-FeedForward[3][0]
__________________________________________________________________________________________________
Transformer-FeedForward-Norm (L (None, None, 312)    624         Transformer-FeedForward-Add[0][0]
                                                                 Transformer-FeedForward-Add[1][0]
                                                                 Transformer-FeedForward-Add[2][0]
                                                                 Transformer-FeedForward-Add[3][0]
__________________________________________________________________________________________________
dense_7 (Dense)                 (None, None, 4)      1252        Transformer-FeedForward-Norm[3][0
__________________________________________________________________________________________________
conditional_random_field_1 (Con (None, None, 4)      16          dense_7[0][0]
==================================================================================================
Total params: 7,926,380
Trainable params: 7,926,380
Non-trainable params: 0
__________________________________________________________________________________________________
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/keras/optimizers.py:790: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.
WARNING:tensorflow:From /home/bureaux/miniconda3/envs/Keras-base/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py:2403: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
batch_token_ids shape: (256, 200)
batch_segment_ids shape: (256, 200)
batch_labels shape: (256, 200)
batch_token_ids shape: (256, 200)
batch_segment_ids shape: (256, 200)
batch_labels shape: (256, 200)
batch_token_ids shape: (256, 200)
batch_segment_ids shape: (256, 200)
batch_labels shape: (256, 200)
batch_token_ids shape: (256, 200)
batch_segment_ids shape: (256, 200)
batch_labels shape: (256, 200)
batch_token_ids shape: (256, 200)
batch_segment_ids shape: (256, 200)
batch_labels shape: (256, 200)
Epoch 1/100
2021-12-27 16:26:13.909568: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcublas.so.10.0
67/67 [==============================] - 45s 666ms/step - loss: 146.1662 - sparse_accuracy: 0.3857 - val_loss: 120.9039 - val_sparse_accuracy: 0.5961
acc: 0.38381, best acc: 0.38381
Epoch 2/100
67/67 [==============================] - 37s 546ms/step - loss: 72.0460 - sparse_accuracy: 0.7783 - val_loss: 38.5646 - val_sparse_accuracy: 0.8638
acc: 0.82993, best acc: 0.82993
Epoch 3/100
67/67 [==============================] - 39s 579ms/step - loss: 29.4334 - sparse_accuracy: 0.8945 - val_loss: 24.0814 - val_sparse_accuracy: 0.9126
acc: 0.87453, best acc: 0.87453
Epoch 4/100
67/67 [==============================] - 40s 591ms/step - loss: 20.7082 - sparse_accuracy: 0.9249 - val_loss: 18.7074 - val_sparse_accuracy: 0.9327
acc: 0.89975, best acc: 0.89975
Epoch 5/100
67/67 [==============================] - 39s 589ms/step - loss: 16.6568 - sparse_accuracy: 0.9408 - val_loss: 15.9748 - val_sparse_accuracy: 0.9432
acc: 0.91316, best acc: 0.91316
Epoch 6/100
67/67 [==============================] - 40s 590ms/step - loss: 14.2586 - sparse_accuracy: 0.9497 - val_loss: 14.3159 - val_sparse_accuracy: 0.9499
acc: 0.92553, best acc: 0.92553
Epoch 7/100
67/67 [==============================] - 40s 599ms/step - loss: 12.5628 - sparse_accuracy: 0.9558 - val_loss: 13.0954 - val_sparse_accuracy: 0.9542
acc: 0.92730, best acc: 0.92730
Epoch 8/100
67/67 [==============================] - 40s 597ms/step - loss: 11.1887 - sparse_accuracy: 0.9606 - val_loss: 12.1536 - val_sparse_accuracy: 0.9574
acc: 0.93439, best acc: 0.93439
Epoch 9/100
67/67 [==============================] - 41s 607ms/step - loss: 10.0560 - sparse_accuracy: 0.9646 - val_loss: 11.5364 - val_sparse_accuracy: 0.9599
acc: 0.93677, best acc: 0.93677
Epoch 10/100
67/67 [==============================] - 41s 607ms/step - loss: 9.0642 - sparse_accuracy: 0.9682 - val_loss: 11.0945 - val_sparse_accuracy: 0.9619
acc: 0.93976, best acc: 0.93976
Epoch 11/100
67/67 [==============================] - 43s 638ms/step - loss: 8.1814 - sparse_accuracy: 0.9715 - val_loss: 10.9071 - val_sparse_accuracy: 0.9624
acc: 0.94325, best acc: 0.94325
Epoch 12/100
67/67 [==============================] - 40s 604ms/step - loss: 7.3678 - sparse_accuracy: 0.9743 - val_loss: 10.7173 - val_sparse_accuracy: 0.9634
acc: 0.94433, best acc: 0.94433
Epoch 13/100
67/67 [==============================] - 41s 609ms/step - loss: 6.6055 - sparse_accuracy: 0.9772 - val_loss: 10.6109 - val_sparse_accuracy: 0.9648
acc: 0.94404, best acc: 0.94433
Epoch 14/100
67/67 [==============================] - 40s 603ms/step - loss: 5.8823 - sparse_accuracy: 0.9800 - val_loss: 10.6749 - val_sparse_accuracy: 0.9653
acc: 0.94521, best acc: 0.94521
Epoch 15/100
67/67 [==============================] - 40s 591ms/step - loss: 5.2907 - sparse_accuracy: 0.9821 - val_loss: 10.8598 - val_sparse_accuracy: 0.9652
acc: 0.94216, best acc: 0.94521
Epoch 16/100
67/67 [==============================] - 41s 606ms/step - loss: 4.6180 - sparse_accuracy: 0.9847 - val_loss: 11.0568 - val_sparse_accuracy: 0.9657
acc: 0.94718, best acc: 0.94718
Epoch 17/100
67/67 [==============================] - 40s 595ms/step - loss: 4.0183 - sparse_accuracy: 0.9868 - val_loss: 11.5016 - val_sparse_accuracy: 0.9657
acc: 0.94859, best acc: 0.94859
Epoch 18/100
67/67 [==============================] - 39s 581ms/step - loss: 3.4665 - sparse_accuracy: 0.9890 - val_loss: 11.8867 - val_sparse_accuracy: 0.9656
acc: 0.94652, best acc: 0.94859
Epoch 19/100
67/67 [==============================] - 41s 605ms/step - loss: 2.9961 - sparse_accuracy: 0.9907 - val_loss: 12.7162 - val_sparse_accuracy: 0.9653
acc: 0.94867, best acc: 0.94867
Epoch 20/100
67/67 [==============================] - 40s 604ms/step - loss: 2.5895 - sparse_accuracy: 0.9922 - val_loss: 12.9196 - val_sparse_accuracy: 0.9658
acc: 0.94725, best acc: 0.94867
Epoch 21/100
67/67 [==============================] - 41s 615ms/step - loss: 2.2456 - sparse_accuracy: 0.9934 - val_loss: 13.6294 - val_sparse_accuracy: 0.9652
acc: 0.94747, best acc: 0.94867
Epoch 22/100
67/67 [==============================] - 40s 603ms/step - loss: 1.9511 - sparse_accuracy: 0.9945 - val_loss: 14.1197 - val_sparse_accuracy: 0.9657
acc: 0.94575, best acc: 0.94867
Epoch 23/100
67/67 [==============================] - 40s 601ms/step - loss: 1.6907 - sparse_accuracy: 0.9955 - val_loss: 14.6295 - val_sparse_accuracy: 0.9655
acc: 0.94669, best acc: 0.94867
Epoch 00023: early stopping